<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>bananaappletw's blog Blog</title>
        <link>https://bananaappletw.github.io/blog</link>
        <description>bananaappletw's blog Blog</description>
        <lastBuildDate>Sat, 04 Sep 2021 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[How to interview security engineer]]></title>
            <link>https://bananaappletw.github.io/blog/how-to-interview-security-engineer</link>
            <guid>https://bananaappletw.github.io/blog/how-to-interview-security-engineer</guid>
            <pubDate>Sat, 04 Sep 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[OWASP TOP 10]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="owasp-top-10">OWASP TOP 10<a href="#owasp-top-10" class="hash-link" aria-label="Direct link to OWASP TOP 10" title="Direct link to OWASP TOP 10">​</a></h2><p><a href="https://owasp.org/www-project-top-ten/" target="_blank" rel="noopener noreferrer">OWASP TOP 10</a></p>]]></content:encoded>
            <category>security</category>
        </item>
        <item>
            <title><![CDATA[OpSec]]></title>
            <link>https://bananaappletw.github.io/blog/opsec</link>
            <guid>https://bananaappletw.github.io/blog/opsec</guid>
            <pubDate>Tue, 27 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Two-Factor Authentication (2FA)]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="two-factor-authentication-2fa">Two-Factor Authentication (2FA)<a href="#two-factor-authentication-2fa" class="hash-link" aria-label="Direct link to Two-Factor Authentication (2FA)" title="Direct link to Two-Factor Authentication (2FA)">​</a></h2><p>Enable Two-Factor Authentication on every service, and keep your device with you.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="filevault">FileVault<a href="#filevault" class="hash-link" aria-label="Direct link to FileVault" title="Direct link to FileVault">​</a></h2><p>Enable FileVault to encrypt disk</p><p><a href="https://support.apple.com/en-us/HT204837" target="_blank" rel="noopener noreferrer">Ref</a></p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>Lock Your Desktop When You're Away.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="seperate-browsers-for-different-purposes">Seperate browsers for different purposes<a href="#seperate-browsers-for-different-purposes" class="hash-link" aria-label="Direct link to Seperate browsers for different purposes" title="Direct link to Seperate browsers for different purposes">​</a></h2><p>For example, I usually used two browsers(Chrome Stable and Chrome Canary). Chrome Stable for my personal use, I will install any Chrome plugin I want on this browser. Chrome Canary for company use, without any Chrome plugin installed.</p><p><a href="https://blog.chromium.org/2017/08/run-multiple-versions-of-chrome-side-by.html" target="_blank" rel="noopener noreferrer">run-multiple-versions-of-chrome-side-by.html</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="email">Email<a href="#email" class="hash-link" aria-label="Direct link to Email" title="Direct link to Email">​</a></h2><p>Register SPF for your domain to detect forging sender addresses</p><p><a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework" target="_blank" rel="noopener noreferrer">SPF</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privacy">Privacy<a href="#privacy" class="hash-link" aria-label="Direct link to Privacy" title="Direct link to Privacy">​</a></h2><p>Whenever we are using the software, some of them will collect your data. For example, search history.</p><p><a href="https://www.privacytools.io/" target="_blank" rel="noopener noreferrer">Privacy tool</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="periodically-check-your-data-not-leaked">Periodically check your data not leaked<a href="#periodically-check-your-data-not-leaked" class="hash-link" aria-label="Direct link to Periodically check your data not leaked" title="Direct link to Periodically check your data not leaked">​</a></h2><p><a href="https://haveibeenpwned.com/" target="_blank" rel="noopener noreferrer">https://haveibeenpwned.com/</a></p>]]></content:encoded>
            <category>security</category>
        </item>
        <item>
            <title><![CDATA[GCP resource hierarchy]]></title>
            <link>https://bananaappletw.github.io/blog/gcp-resource-hierarchy</link>
            <guid>https://bananaappletw.github.io/blog/gcp-resource-hierarchy</guid>
            <pubDate>Fri, 23 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Overview]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>Scenario:</p><ul><li>A company size of <code>200</code> people seperated into <code>10</code> teams.</li><li>Administer can have the company-wide policy to limit GCP account.</li><li>Easy way to switch user to the other team.</li><li>Single login page for user to login</li><li>Each team wants its own access to its resources.</li><li>Also, different environment for specific purpose.</li><li>Sometimes, they need temporarily cooperation between teams.</li><li>For auditing, bills should be seperated by each team.</li></ul><p>Solution:</p><ul><li><a href="https://support.google.com/groups" target="_blank" rel="noopener noreferrer">Google Group</a> to grouping user by team or functionality.</li><li><a href="https://support.google.com/a/answer/167100" target="_blank" rel="noopener noreferrer">Nesting</a> group to organize members within the team.</li><li><a href="https://cloud.google.com/resource-manager/docs/creating-managing-folders" target="_blank" rel="noopener noreferrer">GCP folder</a> to have hiearchy architecture.</li><li>Set <a href="https://cloud.google.com/resource-manager/docs/access-control-folders" target="_blank" rel="noopener noreferrer">IAM</a> role by Google Group email</li><li>Set <a href="https://cloud.google.com/resource-manager/docs/organization-policy/overview" target="_blank" rel="noopener noreferrer">Organization Policy</a> on GCP folder limit resource.</li><li>Using seperated GCP folder for different enviroment, producion, staging...... .</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="organization">Organization<a href="#organization" class="hash-link" aria-label="Direct link to Organization" title="Direct link to Organization">​</a></h2><div class="mermaid">
	graph LR
		R[Organization root] --&gt; A[Team A folder]
		R[Organization root] --&gt; B[Team B folder]
		A[Company folder] --&gt; A1[Team A production folder]
		A[Company folder] --&gt; A2[Team A staging folder]
		B[Company folder] --&gt; B1[Team B production folder]
		B[Company folder] --&gt; B2[Team B staging folder]
		R[Organization root] --&gt; P[playground folder]
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nested-google-group">Nested Google Group<a href="#nested-google-group" class="hash-link" aria-label="Direct link to Nested Google Group" title="Direct link to Nested Google Group">​</a></h2><div class="mermaid">
graph LR
    subgraph A [Team A Google Group]
    A1[Team A production Google Group]
    A2[Team A staging Google Group]
    end
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iam-relationship-between-google-group-and-google-project">IAM relationship between Google Group and Google project<a href="#iam-relationship-between-google-group-and-google-project" class="hash-link" aria-label="Direct link to IAM relationship between Google Group and Google project" title="Direct link to IAM relationship between Google Group and Google project">​</a></h2><div class="mermaid">
	graph LR
		A[Team A Google Group] -- Folder Admin/Owner --&gt;AF[Team A folder]
		A1[Team A production Google Group] -- Folder Admin/Owner --&gt;A1F[Team A production folder]
		A2[Team A production Google Group] -- Folder Admin/Owner --&gt;A2F[Team A staging folder]
		P[playground Google Group] -- Folder Admin/Owner --&gt;PF[Team B playground folder]
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terraform">Terraform<a href="#terraform" class="hash-link" aria-label="Direct link to Terraform" title="Direct link to Terraform">​</a></h2><ul><li><a href="https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742" target="_blank" rel="noopener noreferrer">Seed project</a> (Not Recommanded)</li></ul><p>Create service account per GCP project as Terraform repo's credential.</p><ul><li><a href="https://registry.terraform.io/providers/hashicorp/google/latest/docs" target="_blank" rel="noopener noreferrer">one-to-one mapping between Terraform repo and GCP project</a></li></ul><div class="mermaid">
	graph LR;
		A[A GCP project] --&gt; AT[A Terraform repo];
		AT[A Terraform repo] --&gt; A[A GCP project];
		B[B GCP project] --&gt; BT[B Terraform repo];
		BT[B Terraform repo] --&gt; B[B GCP project];
</div>]]></content:encoded>
            <category>gcp</category>
        </item>
        <item>
            <title><![CDATA[KVM GPU passthrough Ubuntu 20.04]]></title>
            <link>https://bananaappletw.github.io/blog/kvm-gpu-passthrough-ubuntu-20-04</link>
            <guid>https://bananaappletw.github.io/blog/kvm-gpu-passthrough-ubuntu-20-04</guid>
            <pubDate>Mon, 05 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Environment]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment">Environment<a href="#environment" class="hash-link" aria-label="Direct link to Environment" title="Direct link to Environment">​</a></h2><ul><li>Host: Ubuntu 20.04</li><li>Guest: Ubuntu 20.04</li><li>GPU: NVIDIA® GeForce® RTX 2080 Ti</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-iommu">Enable IOMMU<a href="#enable-iommu" class="hash-link" aria-label="Direct link to Enable IOMMU" title="Direct link to Enable IOMMU">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-grub">Configure GRUB<a href="#configure-grub" class="hash-link" aria-label="Direct link to Configure GRUB" title="Direct link to Configure GRUB">​</a></h3><p>Edit <code>/etc/default/grub</code></p><div class="language-grub codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-grub codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Intel CPU</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT="intel_iommu=on"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># AMD CPU</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT="amd_iommu=on iommu=pt kvm_amd.npt=1 kvm_amd.avic=1"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-grub">Update GRUB<a href="#update-grub" class="hash-link" aria-label="Direct link to Update GRUB" title="Direct link to Update GRUB">​</a></h3><p><code>sudo update-grub</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reboot">Reboot<a href="#reboot" class="hash-link" aria-label="Direct link to Reboot" title="Direct link to Reboot">​</a></h3><p><code>sudo shutdown -r now</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-iommu-is-enabled">Verify IOMMU is enabled<a href="#verify-iommu-is-enabled" class="hash-link" aria-label="Direct link to Verify IOMMU is enabled" title="Direct link to Verify IOMMU is enabled">​</a></h3><p><code>dmesg | grep IOMMU</code></p><p>Output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">IOMMU enabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-iommu-group">Enable IOMMU group<a href="#enable-iommu-group" class="hash-link" aria-label="Direct link to Enable IOMMU group" title="Direct link to Enable IOMMU group">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-iommu-group-is-enabled">Check IOMMU group is enabled<a href="#check-iommu-group-is-enabled" class="hash-link" aria-label="Direct link to Check IOMMU group is enabled" title="Direct link to Check IOMMU group is enabled">​</a></h3><p><code>for a in /sys/kernel/iommu_groups/*; do find $a -type l; done | sort --version-sort</code></p><p>output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/sys/kernel/iommu_groups/0/devices/0000:00:00.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/sys/kernel/iommu_groups/1/devices/0000:00:04.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/sys/kernel/iommu_groups/2/devices/0000:00:04.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/sys/kernel/iommu_groups/3/devices/0000:00:04.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/sys/kernel/iommu_groups/4/devices/0000:00:04.3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="edit-bios-setting-is-not-enabled">Edit BIOS setting is not enabled<a href="#edit-bios-setting-is-not-enabled" class="hash-link" aria-label="Direct link to Edit BIOS setting is not enabled" title="Direct link to Edit BIOS setting is not enabled">​</a></h3><p>If output is not expected, configure BIOS setting</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="vt-d">VT-d<a href="#vt-d" class="hash-link" aria-label="Direct link to VT-d" title="Direct link to VT-d">​</a></h4><p>(Asus)</p><ul><li>Advanced =&gt; System Agent Configuration =&gt; Intel VT for Directed I/O (VT-d)</li></ul><p>(Supermicro)</p><ul><li><p>Advanced =&gt; CPU Configuration =&gt; Intel Virtualization Technology =&gt; <!-- -->[enable]</p></li><li><p>Advanced =&gt; Chipset Configuration =&gt; North Bridge =&gt; IIO Configuration =&gt; Intel VT fot Directed I/O (VT-d) =&gt; <!-- -->[enable]</p></li><li><p><a href="https://superuser.com/questions/1112238/intel-iommu-on-but-no-iommu-groups" target="_blank" rel="noopener noreferrer">https://superuser.com/questions/1112238/intel-iommu-on-but-no-iommu-groups</a></p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="isolation-of-the-guest-gpu">Isolation of the guest GPU<a href="#isolation-of-the-guest-gpu" class="hash-link" aria-label="Direct link to Isolation of the guest GPU" title="Direct link to Isolation of the guest GPU">​</a></h2><div class="mermaid">
graph LR
    subgraph C [guest]
    C1[PCI device]
    end
    subgraph B [hypervisor]
    B1[VFIO] --&gt; C1[PCI device]
    end
    subgraph A [Host]
    A1[PCI device] --&gt; B1[VFIO]
    end
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-vfio-pci-to-manage-pci-device">Using vfio-pci to manage PCI device<a href="#using-vfio-pci-to-manage-pci-device" class="hash-link" aria-label="Direct link to Using vfio-pci to manage PCI device" title="Direct link to Using vfio-pci to manage PCI device">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="find-out-vendor-id-and-device-id">Find out vendor ID and device ID<a href="#find-out-vendor-id-and-device-id" class="hash-link" aria-label="Direct link to Find out vendor ID and device ID" title="Direct link to Find out vendor ID and device ID">​</a></h3><p><code>lspci -nn | grep -i NVIDIA</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation TU102 [GeForce RTX 2080 Ti] [10de:1e04] (rev a1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">01:00.1 Audio device [0403]: NVIDIA Corporation TU102 High Definition Audio Controller [10de:10f7] (rev a1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">01:00.2 USB controller [0c03]: NVIDIA Corporation TU102 USB 3.1 Host Controller [10de:1ad6] (rev a1)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">01:00.3 Serial bus controller [0c80]: NVIDIA Corporation TU102 USB Type-C UCSI Controller [10de:1ad7] (rev a1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>GeForce RTX 2080 Ti VGA compatible controller:
PCI ID:<code>01:00.0</code>
vendor ID: <code>10de</code>
device ID: <code>1e04</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-grub-1">Configure GRUB<a href="#configure-grub-1" class="hash-link" aria-label="Direct link to Configure GRUB" title="Direct link to Configure GRUB">​</a></h3><p><code>/etc/default/grub</code></p><p>Apply all the related devices</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT="intel_iommu=on vfio-pci.ids=10de:1e04,10de:10f7,10de:1ad6,10de:1ad7"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-grub-1">Update GRUB<a href="#update-grub-1" class="hash-link" aria-label="Direct link to Update GRUB" title="Direct link to Update GRUB">​</a></h3><p><code>sudo update-grub</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reboot-1">Reboot<a href="#reboot-1" class="hash-link" aria-label="Direct link to Reboot" title="Direct link to Reboot">​</a></h3><p><code>sudo reboot</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-pci-device-is-managed-by-vfio-pci">Verify PCI device is managed by vfio-pci<a href="#verify-pci-device-is-managed-by-vfio-pci" class="hash-link" aria-label="Direct link to Verify PCI device is managed by vfio-pci" title="Direct link to Verify PCI device is managed by vfio-pci">​</a></h3><p><code>lspci -nnv</code></p><p>Find the line <code>Kernel driver in use</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">0b:00.0 VGA compatible controller [0300]: NVIDIA Corporation TU102 [GeForce RTX 2080 Ti] [10de:1e04] (rev a1) (prog-if 00 [VGA controller])</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Kernel driver in use: vfio-pci</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test-gpu-passthrough-on-kvm-instance">Test GPU passthrough on kvm instance<a href="#test-gpu-passthrough-on-kvm-instance" class="hash-link" aria-label="Direct link to Test GPU passthrough on kvm instance" title="Direct link to Test GPU passthrough on kvm instance">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fresh-install">Fresh install<a href="#fresh-install" class="hash-link" aria-label="Direct link to Fresh install" title="Direct link to Fresh install">​</a></h3><p>Run <code>virt-install</code> with <code>--host-device [device_id]</code> and <code>--features kvm_hidden=on</code> parameters</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">virt-install ... \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--host-device 01:00.0 \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--features kvm_hidden=on \</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-existing-instance">Modify existing instance<a href="#modify-existing-instance" class="hash-link" aria-label="Direct link to Modify existing instance" title="Direct link to Modify existing instance">​</a></h3><p><code>virsh edit [domain]</code></p><p>Add PCI mapping <code>hostdev</code> block</p><p><code>0000:01:00.0</code> within the host will be mapped to <code>0000:04:00.0</code> within guest</p><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p><code>bus</code> number should less than virtio's</p><p>Increase virtio's bus number to spare small number for new added entry</p></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;devices&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;source&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;address domain='0x0000' bus='0x01' slot='0x00'function='0x0'/&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;/source&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;address type='pci' domain='0x0000' bus='0x04'slot='0x00' function='0x0'/&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/hostdev&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;memballoon model='virtio'&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;address type='pci' domain='0x0000' bus='0x05'slot='0x00' function='0x0'/&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/memballoon&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;rng model='virtio'&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;backend model='random'&gt;/dev/urandom&lt;/backend&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;address type='pci' domain='0x0000' bus='0x06'slot='0x00' function='0x0'/&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/rng&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/devices&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kvm hidden</code> within <code>features</code> block</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;features&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &lt;kvm&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;hidden state='on'/&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &lt;/kvm&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/features&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-gpu-is-working-in-guest">Check GPU is working in guest<a href="#check-gpu-is-working-in-guest" class="hash-link" aria-label="Direct link to Check GPU is working in guest" title="Direct link to Check GPU is working in guest">​</a></h2><p><code>lspci</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">04:00.0 VGA compatible controller: NVIDIA Corporation TU102[GeForce RTX 2080 Ti] (rev a1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Install NVIDIA driver</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install nvidia-driver-460</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>nvidia-smi</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Wed Mar 10 08:19:43 2021</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| NVIDIA-SMI 460.39       Driver Version: 460.39       CUDVersion: 11.2     |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|-------------------------------+--------------------+----------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| GPU  Name        Persistence-M| Bus-Id        Disp.A Volatile Uncorr. ECC |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage GPU-Util  Compute M. |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                               |                    |               MIG M. |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|===============================+====================+======================|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   0  GeForce RTX 208...  Off  | 00000000:04:00.0 Of|                  N/A |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| 15%   44C    P0     1W / 250W |      0MiB / 11019Mi|      0%      Default |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|                               |                    |                  N/A |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+-------------------------------+--------------------+----------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Processes:                                                                |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|  GPU   GI   CI        PID   Type   Procesname                  GPU Memory |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|        ID ID                                                 Usage      |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">===========================================================================|</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|  No running processefound                                                 |</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">+---------------------------------------------------------------------------+</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2><ul><li><a href="https://mathiashueber.com/pci-passthrough-ubuntu-2004-virtual-machine/" target="_blank" rel="noopener noreferrer">https://mathiashueber.com/pci-passthrough-ubuntu-2004-virtual-machine/</a></li></ul>]]></content:encoded>
            <category>kvm</category>
            <category>cloud-init</category>
            <category>vfio</category>
            <category>GPU</category>
        </item>
        <item>
            <title><![CDATA[AWS resource hierarchy]]></title>
            <link>https://bananaappletw.github.io/blog/aws-resource-hierarchy</link>
            <guid>https://bananaappletw.github.io/blog/aws-resource-hierarchy</guid>
            <pubDate>Sat, 03 Jul 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Overview]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>Scenario:</p><ul><li>A company size of <code>200</code> people seperated into <code>10</code> teams.</li><li>Administer can have the company-wide policy to limit AWS account.</li><li>Easy way to switch user to the other team.</li><li>Single login page for user to login</li><li>Each team wants its own access to its resources.</li><li>Also, different environment for specific purpose.</li><li>Sometimes, they need temporarily cooperation between teams.</li><li>For auditing, bills should be seperated by each team.</li></ul><p>Solution:</p><ul><li><a href="https://aws.amazon.com/tw/organizations/" target="_blank" rel="noopener noreferrer">AWS Organization</a> to have hiearchy architecture.</li><li>Move AWS Accounts into different <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_ous.html" target="_blank" rel="noopener noreferrer">Organizational Unit</a>.</li><li>Attach <a href="https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html" target="_blank" rel="noopener noreferrer">Service Control Policies</a> to OU to limit AWS accounts.</li><li>Using seperated account for different enviroment, producion, staging...... .</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="organization">Organization<a href="#organization" class="hash-link" aria-label="Direct link to Organization" title="Direct link to Organization">​</a></h2><div class="mermaid">
	graph LR
		R[Organization root] --&gt; C[Company OU]
		C[Company OU] --&gt; A1[Team A production AWS account]
		C[Company OU] --&gt; A2[Team A staging AWS account]
		C[Company OU] --&gt; B1[Team B production AWS account]
		C[Company OU] --&gt; B2[Team B staging AWS account]
		R[Organization root] --&gt; P[playground AWS account]
</div><p>Company OU will whitelist AWS resource and region.
Playground account has no limitation on AWS resource.
Periodically clean resource of playground account.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><a href="https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-alloc-tags.html" target="_blank" rel="noopener noreferrer">AWS Tag</a> is another solution to have more detail bill within AWS account.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="terraform">Terraform<a href="#terraform" class="hash-link" aria-label="Direct link to Terraform" title="Direct link to Terraform">​</a></h2><p>Create <code>terraform</code> IAM access key and attach AdministratorAccess policy as Terraform repo's credential.</p><div class="mermaid">
	graph LR;
		A[A AWS account] --&gt; AT[A Terraform repo];
		AT[A Terraform repo] --&gt; A[A AWS account];
		B[B AWS account] --&gt; BT[B Terraform repo];
		BT[B Terraform repo] --&gt; B[B AWS account];
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sso">SSO<a href="#sso" class="hash-link" aria-label="Direct link to SSO" title="Direct link to SSO">​</a></h2><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Recommended using SSO to manage AWS Accounts, otherwise you will have to manage your account from different place.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-apps-sso">Google apps SSO<a href="#google-apps-sso" class="hash-link" aria-label="Direct link to Google apps SSO" title="Direct link to Google apps SSO">​</a></h3><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>You have to have GSuite super administrator access.</p></div></div><p>Follow the <a href="https://aws.amazon.com/blogs/security/how-to-set-up-federated-single-sign-on-to-aws-using-google-apps/" target="_blank" rel="noopener noreferrer">How to Set Up Federated Single Sign-On to AWS Using Google Apps</a> instruction</p><p>Then, you will find out it's one-to-one mapping between Google account and IAM role.</p><p>We want mapping of Google group and IAM role.</p><p>Refer repo <a href="https://github.com/1Strategy/sso-to-aws-using-gsuite" target="_blank" rel="noopener noreferrer">https://github.com/1Strategy/sso-to-aws-using-gsuite</a></p><p>By using GSuite Admin API</p><p>Iterate the Google group, for each Google account, map to corresponding IAM role</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="aws-sso">AWS SSO<a href="#aws-sso" class="hash-link" aria-label="Direct link to AWS SSO" title="Direct link to AWS SSO">​</a></h3><p><a href="https://aws.amazon.com/tw/single-sign-on/" target="_blank" rel="noopener noreferrer">https://aws.amazon.com/tw/single-sign-on/</a></p><div class="mermaid">
	graph LR;
		A[A AWS account admin group] --&gt; AA[Administer role of A account];
		A[A AWS account readonly group] --&gt; AR[readonly role of account];
		B[B AWS account admin group] --&gt; BA[Administer role of A account];
		B[B AWS account readonly group] --&gt; BR[readonly role of account];
</div><p>Assign user to group to have access to account.</p><p><a href="https://aws.amazon.com/blogs/security/aws-single-sign-on-now-enables-command-line-interface-access-for-aws-accounts-using-corporate-credentials/" target="_blank" rel="noopener noreferrer">Neat short-term credentials for command line interface</a></p>]]></content:encoded>
            <category>aws</category>
        </item>
    </channel>
</rss>