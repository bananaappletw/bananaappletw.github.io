(self.webpackChunkblog=self.webpackChunkblog||[]).push([[3806,2146,1410,1863],{18452:(e,t,n)=>{var a={"./aws-resource-hierarchy.md":15715,"./gcp-resource-hierarchy.md":45295,"./how-to-interview-security-engineer.md":73128,"./kvm-gpu-passthrough-ubuntu-20-04.md":21827,"./opsec.md":98871};function o(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=r,e.exports=o,o.id=18452},88226:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var a=n(87462),o=n(67294),r=n(86010),i=n(16963),l=n(39960);var s;const p=(s=n(18452)).keys().reduce(((e,t,n)=>{const a=s(t),{date:o,formattedDate:r,title:i,permalink:l}=a.metadata;return[...e,{date:o,formattedDate:r,title:i,permalink:l}]}),[]).reduceRight(((e,t)=>{const n=t.date.split("-")[0],a=e.get(n)||[];return e.set(n,[t,...a])}),new Map),u=Array.from(p,(e=>{let[t,n]=e;return{year:t,posts:n}}));function d(e){let{year:t,posts:n}=e;return o.createElement("div",{className:(0,r.Z)("col col--4")},o.createElement("h3",null,t),o.createElement("ul",null,n.map((e=>o.createElement("li",{key:e.date},o.createElement(l.Z,{to:e.permalink},e.formattedDate," - ",e.title))))))}const c=function(){return o.createElement(i.Z,{title:"Blog Archive"},o.createElement("header",{className:(0,r.Z)("hero hero--primary")},o.createElement("div",{className:"container"},o.createElement("h1",{className:"hero__title"},"Blog Archive"),o.createElement("p",{className:"hero__subtitle"},"Historic posts"))),o.createElement("main",null,u&&u.length>0&&o.createElement("section",null,o.createElement("div",{className:"container"},o.createElement("div",{className:"row"},u.map(((e,t)=>o.createElement(d,(0,a.Z)({key:t},e)))))))))}},1504:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(67294),o=n(65231);o.Z.initialize({startOnLoad:!0});const r=e=>{let{chart:t}=e;return(0,a.useEffect)((()=>{o.Z.contentLoaded()}),[]),a.createElement("div",{className:"mermaid"},t)}},15715:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),o=(n(67294),n(3905)),r=n(1504);const i={title:"AWS resource hierarchy",tags:["aws"],date:new Date("2021-07-03T00:00:00.000Z")},l=void 0,s={permalink:"/blog/aws-resource-hierarchy",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/aws-resource-hierarchy.md",source:"@site/blog/aws-resource-hierarchy.md",title:"AWS resource hierarchy",description:"Overview",date:"2021-07-03T00:00:00.000Z",formattedDate:"July 3, 2021",tags:[{label:"aws",permalink:"/blog/tags/aws"}],readingTime:2.08,hasTruncateMarker:!1,authors:[],frontMatter:{title:"AWS resource hierarchy",tags:["aws"],date:"2021-07-03T00:00:00.000Z"},prevItem:{title:"KVM GPU passthrough Ubuntu 20.04",permalink:"/blog/kvm-gpu-passthrough-ubuntu-20-04"}},p={authorsImageUrls:[]},u=[{value:"Overview",id:"overview",level:2},{value:"Organization",id:"organization",level:2},{value:"Terraform",id:"terraform",level:2},{value:"SSO",id:"sso",level:2},{value:"Google apps SSO",id:"google-apps-sso",level:3},{value:"AWS SSO",id:"aws-sso",level:3}],d={toc:u};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Scenario:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A company size of ",(0,o.kt)("inlineCode",{parentName:"li"},"200")," people seperated into ",(0,o.kt)("inlineCode",{parentName:"li"},"10")," teams."),(0,o.kt)("li",{parentName:"ul"},"Administer can have the company-wide policy to limit AWS account."),(0,o.kt)("li",{parentName:"ul"},"Easy way to switch user to the other team."),(0,o.kt)("li",{parentName:"ul"},"Single login page for user to login"),(0,o.kt)("li",{parentName:"ul"},"Each team wants its own access to its resources."),(0,o.kt)("li",{parentName:"ul"},"Also, different environment for specific purpose."),(0,o.kt)("li",{parentName:"ul"},"Sometimes, they need temporarily cooperation between teams."),(0,o.kt)("li",{parentName:"ul"},"For auditing, bills should be seperated by each team.")),(0,o.kt)("p",null,"Solution:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://aws.amazon.com/tw/organizations/"},"AWS Organization")," to have hiearchy architecture."),(0,o.kt)("li",{parentName:"ul"},"Move AWS Accounts into different ",(0,o.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_ous.html"},"Organizational Unit"),"."),(0,o.kt)("li",{parentName:"ul"},"Attach ",(0,o.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps.html"},"Service Control Policies")," to OU to limit AWS accounts."),(0,o.kt)("li",{parentName:"ul"},"Using seperated account for different enviroment, producion, staging...... .")),(0,o.kt)("h2",{id:"organization"},"Organization"),(0,o.kt)(r.Z,{chart:"\n\tgraph LR\n\t\tR[Organization root] --\x3e C[Company OU]\n\t\tC[Company OU] --\x3e A1[Team A production AWS account]\n\t\tC[Company OU] --\x3e A2[Team A staging AWS account]\n\t\tC[Company OU] --\x3e B1[Team B production AWS account]\n\t\tC[Company OU] --\x3e B2[Team B staging AWS account]\n\t\tR[Organization root] --\x3e P[playground AWS account]\n",mdxType:"Mermaid"}),(0,o.kt)("p",null,"Company OU will whitelist AWS resource and region.\nPlayground account has no limitation on AWS resource.\nPeriodically clean resource of playground account."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/cost-alloc-tags.html"},"AWS Tag")," is another solution to have more detail bill within AWS account.")),(0,o.kt)("h2",{id:"terraform"},"Terraform"),(0,o.kt)("p",null,"Create ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform")," IAM access key and attach AdministratorAccess policy as Terraform repo's credential."),(0,o.kt)(r.Z,{chart:"\n\tgraph LR;\n\t\tA[A AWS account] --\x3e AT[A Terraform repo];\n\t\tAT[A Terraform repo] --\x3e A[A AWS account];\n\t\tB[B AWS account] --\x3e BT[B Terraform repo];\n\t\tBT[B Terraform repo] --\x3e B[B AWS account];\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"sso"},"SSO"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Recommended using SSO to manage AWS Accounts, otherwise you will have to manage your account from different place.")),(0,o.kt)("h3",{id:"google-apps-sso"},"Google apps SSO"),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"You have to have GSuite super administrator access.")),(0,o.kt)("p",null,"Follow the ",(0,o.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/security/how-to-set-up-federated-single-sign-on-to-aws-using-google-apps/"},"How to Set Up Federated Single Sign-On to AWS Using Google Apps")," instruction"),(0,o.kt)("p",null,"Then, you will find out it's one-to-one mapping between Google account and IAM role."),(0,o.kt)("p",null,"We want mapping of Google group and IAM role."),(0,o.kt)("p",null,"Refer repo ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/1Strategy/sso-to-aws-using-gsuite"},"https://github.com/1Strategy/sso-to-aws-using-gsuite")),(0,o.kt)("p",null,"By using GSuite Admin API"),(0,o.kt)("p",null,"Iterate the Google group, for each Google account, map to corresponding IAM role"),(0,o.kt)("h3",{id:"aws-sso"},"AWS SSO"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://aws.amazon.com/tw/single-sign-on/"},"https://aws.amazon.com/tw/single-sign-on/")),(0,o.kt)(r.Z,{chart:"\n\tgraph LR;\n\t\tA[A AWS account admin group] --\x3e AA[Administer role of A account];\n\t\tA[A AWS account readonly group] --\x3e AR[readonly role of account];\n\t\tB[B AWS account admin group] --\x3e BA[Administer role of A account];\n\t\tB[B AWS account readonly group] --\x3e BR[readonly role of account];\n",mdxType:"Mermaid"}),(0,o.kt)("p",null,"Assign user to group to have access to account."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/security/aws-single-sign-on-now-enables-command-line-interface-access-for-aws-accounts-using-corporate-credentials/"},"Neat short-term credentials for command line interface")))}c.isMDXComponent=!0},45295:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),o=(n(67294),n(3905)),r=n(1504);const i={title:"GCP resource hierarchy",tags:["gcp"],date:new Date("2021-07-23T00:00:00.000Z")},l=void 0,s={permalink:"/blog/gcp-resource-hierarchy",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/gcp-resource-hierarchy.md",source:"@site/blog/gcp-resource-hierarchy.md",title:"GCP resource hierarchy",description:"Overview",date:"2021-07-23T00:00:00.000Z",formattedDate:"July 23, 2021",tags:[{label:"gcp",permalink:"/blog/tags/gcp"}],readingTime:1.66,hasTruncateMarker:!1,authors:[],frontMatter:{title:"GCP resource hierarchy",tags:["gcp"],date:"2021-07-23T00:00:00.000Z"},prevItem:{title:"OpSec",permalink:"/blog/opsec"},nextItem:{title:"KVM GPU passthrough Ubuntu 20.04",permalink:"/blog/kvm-gpu-passthrough-ubuntu-20-04"}},p={authorsImageUrls:[]},u=[{value:"Overview",id:"overview",level:2},{value:"Organization",id:"organization",level:2},{value:"Nested Google Group",id:"nested-google-group",level:2},{value:"IAM relationship between Google Group and Google project",id:"iam-relationship-between-google-group-and-google-project",level:2},{value:"Terraform",id:"terraform",level:2}],d={toc:u};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Scenario:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A company size of ",(0,o.kt)("inlineCode",{parentName:"li"},"200")," people seperated into ",(0,o.kt)("inlineCode",{parentName:"li"},"10")," teams."),(0,o.kt)("li",{parentName:"ul"},"Administer can have the company-wide policy to limit GCP account."),(0,o.kt)("li",{parentName:"ul"},"Easy way to switch user to the other team."),(0,o.kt)("li",{parentName:"ul"},"Single login page for user to login"),(0,o.kt)("li",{parentName:"ul"},"Each team wants its own access to its resources."),(0,o.kt)("li",{parentName:"ul"},"Also, different environment for specific purpose."),(0,o.kt)("li",{parentName:"ul"},"Sometimes, they need temporarily cooperation between teams."),(0,o.kt)("li",{parentName:"ul"},"For auditing, bills should be seperated by each team.")),(0,o.kt)("p",null,"Solution:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://support.google.com/groups"},"Google Group")," to grouping user by team or functionality."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://support.google.com/a/answer/167100"},"Nesting")," group to organize members within the team."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/creating-managing-folders"},"GCP folder")," to have hiearchy architecture."),(0,o.kt)("li",{parentName:"ul"},"Set ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/access-control-folders"},"IAM")," role by Google Group email"),(0,o.kt)("li",{parentName:"ul"},"Set ",(0,o.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/organization-policy/overview"},"Organization Policy")," on GCP folder limit resource."),(0,o.kt)("li",{parentName:"ul"},"Using seperated GCP folder for different enviroment, producion, staging...... .")),(0,o.kt)("h2",{id:"organization"},"Organization"),(0,o.kt)(r.Z,{chart:"\n\tgraph LR\n\t\tR[Organization root] --\x3e A[Team A folder]\n\t\tR[Organization root] --\x3e B[Team B folder]\n\t\tA[Company folder] --\x3e A1[Team A production folder]\n\t\tA[Company folder] --\x3e A2[Team A staging folder]\n\t\tB[Company folder] --\x3e B1[Team B production folder]\n\t\tB[Company folder] --\x3e B2[Team B staging folder]\n\t\tR[Organization root] --\x3e P[playground folder]\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"nested-google-group"},"Nested Google Group"),(0,o.kt)(r.Z,{chart:"\ngraph LR\n    subgraph A [Team A Google Group]\n    A1[Team A production Google Group]\n    A2[Team A staging Google Group]\n    end\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"iam-relationship-between-google-group-and-google-project"},"IAM relationship between Google Group and Google project"),(0,o.kt)(r.Z,{chart:"\n\tgraph LR\n\t\tA[Team A Google Group] -- Folder Admin/Owner --\x3eAF[Team A folder]\n\t\tA1[Team A production Google Group] -- Folder Admin/Owner --\x3eA1F[Team A production folder]\n\t\tA2[Team A production Google Group] -- Folder Admin/Owner --\x3eA2F[Team A staging folder]\n\t\tP[playground Google Group] -- Folder Admin/Owner --\x3ePF[Team B playground folder]\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"terraform"},"Terraform"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742"},"Seed project")," (Not Recommanded)")),(0,o.kt)("p",null,"Create service account per GCP project as Terraform repo's credential."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs"},"one-to-one mapping between Terraform repo and GCP project"))),(0,o.kt)(r.Z,{chart:"\n\tgraph LR;\n\t\tA[A GCP project] --\x3e AT[A Terraform repo];\n\t\tAT[A Terraform repo] --\x3e A[A GCP project];\n\t\tB[B GCP project] --\x3e BT[B Terraform repo];\n\t\tBT[B Terraform repo] --\x3e B[B GCP project];\n",mdxType:"Mermaid"}))}c.isMDXComponent=!0},73128:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const r={title:"How to interview security engineer",tags:["security"],date:new Date("2021-09-04T00:00:00.000Z")},i=void 0,l={permalink:"/blog/how-to-interview-security-engineer",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/how-to-interview-security-engineer.md",source:"@site/blog/how-to-interview-security-engineer.md",title:"How to interview security engineer",description:"OWASP TOP 10",date:"2021-09-04T00:00:00.000Z",formattedDate:"September 4, 2021",tags:[{label:"security",permalink:"/blog/tags/security"}],readingTime:.035,hasTruncateMarker:!1,authors:[],frontMatter:{title:"How to interview security engineer",tags:["security"],date:"2021-09-04T00:00:00.000Z"},nextItem:{title:"OpSec",permalink:"/blog/opsec"}},s={authorsImageUrls:[]},p=[{value:"OWASP TOP 10",id:"owasp-top-10",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"owasp-top-10"},"OWASP TOP 10"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://owasp.org/www-project-top-ten/"},"OWASP TOP 10")))}d.isMDXComponent=!0},21827:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),o=(n(67294),n(3905)),r=n(1504);const i={title:"KVM GPU passthrough Ubuntu 20.04",tags:["kvm","cloud-init","vfio","GPU"],date:new Date("2021-07-05T00:00:00.000Z")},l=void 0,s={permalink:"/blog/kvm-gpu-passthrough-ubuntu-20-04",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/kvm-gpu-passthrough-ubuntu-20-04.md",source:"@site/blog/kvm-gpu-passthrough-ubuntu-20-04.md",title:"KVM GPU passthrough Ubuntu 20.04",description:"Environment",date:"2021-07-05T00:00:00.000Z",formattedDate:"July 5, 2021",tags:[{label:"kvm",permalink:"/blog/tags/kvm"},{label:"cloud-init",permalink:"/blog/tags/cloud-init"},{label:"vfio",permalink:"/blog/tags/vfio"},{label:"GPU",permalink:"/blog/tags/gpu"}],readingTime:3.13,hasTruncateMarker:!1,authors:[],frontMatter:{title:"KVM GPU passthrough Ubuntu 20.04",tags:["kvm","cloud-init","vfio","GPU"],date:"2021-07-05T00:00:00.000Z"},prevItem:{title:"GCP resource hierarchy",permalink:"/blog/gcp-resource-hierarchy"},nextItem:{title:"AWS resource hierarchy",permalink:"/blog/aws-resource-hierarchy"}},p={authorsImageUrls:[]},u=[{value:"Environment",id:"environment",level:2},{value:"Enable IOMMU",id:"enable-iommu",level:2},{value:"Configure GRUB",id:"configure-grub",level:3},{value:"Update GRUB",id:"update-grub",level:3},{value:"Reboot",id:"reboot",level:3},{value:"Verify IOMMU is enabled",id:"verify-iommu-is-enabled",level:3},{value:"Enable IOMMU group",id:"enable-iommu-group",level:2},{value:"Check IOMMU group is enabled",id:"check-iommu-group-is-enabled",level:3},{value:"Edit BIOS setting is not enabled",id:"edit-bios-setting-is-not-enabled",level:3},{value:"VT-d",id:"vt-d",level:4},{value:"Isolation of the guest GPU",id:"isolation-of-the-guest-gpu",level:2},{value:"Using vfio-pci to manage PCI device",id:"using-vfio-pci-to-manage-pci-device",level:2},{value:"Find out vendor ID and device ID",id:"find-out-vendor-id-and-device-id",level:3},{value:"Configure GRUB",id:"configure-grub-1",level:3},{value:"Update GRUB",id:"update-grub-1",level:3},{value:"Reboot",id:"reboot-1",level:3},{value:"Verify PCI device is managed by vfio-pci",id:"verify-pci-device-is-managed-by-vfio-pci",level:3},{value:"Test GPU passthrough on kvm instance",id:"test-gpu-passthrough-on-kvm-instance",level:2},{value:"Fresh install",id:"fresh-install",level:3},{value:"Modify existing instance",id:"modify-existing-instance",level:3},{value:"Check GPU is working in guest",id:"check-gpu-is-working-in-guest",level:2},{value:"Reference",id:"reference",level:2}],d={toc:u};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"environment"},"Environment"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Host: Ubuntu 20.04"),(0,o.kt)("li",{parentName:"ul"},"Guest: Ubuntu 20.04"),(0,o.kt)("li",{parentName:"ul"},"GPU: NVIDIA\xae GeForce\xae RTX 2080 Ti")),(0,o.kt)("h2",{id:"enable-iommu"},"Enable IOMMU"),(0,o.kt)("h3",{id:"configure-grub"},"Configure GRUB"),(0,o.kt)("p",null,"Edit ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/default/grub")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-grub"},'# Intel CPU\nGRUB_CMDLINE_LINUX_DEFAULT="intel_iommu=on"\n# AMD CPU\nGRUB_CMDLINE_LINUX_DEFAULT="amd_iommu=on iommu=pt kvm_amd.npt=1 kvm_amd.avic=1"\n')),(0,o.kt)("h3",{id:"update-grub"},"Update GRUB"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sudo update-grub")),(0,o.kt)("h3",{id:"reboot"},"Reboot"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sudo shutdown -r now")),(0,o.kt)("h3",{id:"verify-iommu-is-enabled"},"Verify IOMMU is enabled"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"dmesg | grep IOMMU")),(0,o.kt)("p",null,"Output:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"IOMMU enabled\n")),(0,o.kt)("h2",{id:"enable-iommu-group"},"Enable IOMMU group"),(0,o.kt)("h3",{id:"check-iommu-group-is-enabled"},"Check IOMMU group is enabled"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"for a in /sys/kernel/iommu_groups/*; do find $a -type l; done | sort --version-sort")),(0,o.kt)("p",null,"output:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"/sys/kernel/iommu_groups/0/devices/0000:00:00.0\n/sys/kernel/iommu_groups/1/devices/0000:00:04.0\n/sys/kernel/iommu_groups/2/devices/0000:00:04.1\n/sys/kernel/iommu_groups/3/devices/0000:00:04.2\n/sys/kernel/iommu_groups/4/devices/0000:00:04.3\n")),(0,o.kt)("h3",{id:"edit-bios-setting-is-not-enabled"},"Edit BIOS setting is not enabled"),(0,o.kt)("p",null,"If output is not expected, configure BIOS setting"),(0,o.kt)("h4",{id:"vt-d"},"VT-d"),(0,o.kt)("p",null,"(Asus)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Advanced => System Agent Configuration => Intel VT for Directed I/O (VT-d)")),(0,o.kt)("p",null,"(Supermicro)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Advanced => CPU Configuration => Intel Virtualization Technology => ","[enable]")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Advanced => Chipset Configuration => North Bridge => IIO Configuration => Intel VT fot Directed I/O (VT-d) => ","[enable]")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://superuser.com/questions/1112238/intel-iommu-on-but-no-iommu-groups"},"https://superuser.com/questions/1112238/intel-iommu-on-but-no-iommu-groups")))),(0,o.kt)("h2",{id:"isolation-of-the-guest-gpu"},"Isolation of the guest GPU"),(0,o.kt)(r.Z,{chart:"\ngraph LR\n    subgraph C [guest]\n    C1[PCI device]\n    end\n    subgraph B [hypervisor]\n    B1[VFIO] --\x3e C1[PCI device]\n    end\n    subgraph A [Host]\n    A1[PCI device] --\x3e B1[VFIO]\n    end\n",mdxType:"Mermaid"}),(0,o.kt)("h2",{id:"using-vfio-pci-to-manage-pci-device"},"Using vfio-pci to manage PCI device"),(0,o.kt)("h3",{id:"find-out-vendor-id-and-device-id"},"Find out vendor ID and device ID"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"lspci -nn | grep -i NVIDIA")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"01:00.0 VGA compatible controller [0300]: NVIDIA Corporation TU102 [GeForce RTX 2080 Ti] [10de:1e04] (rev a1)\n01:00.1 Audio device [0403]: NVIDIA Corporation TU102 High Definition Audio Controller [10de:10f7] (rev a1)\n01:00.2 USB controller [0c03]: NVIDIA Corporation TU102 USB 3.1 Host Controller [10de:1ad6] (rev a1)\n01:00.3 Serial bus controller [0c80]: NVIDIA Corporation TU102 USB Type-C UCSI Controller [10de:1ad7] (rev a1)\n")),(0,o.kt)("p",null,"GeForce RTX 2080 Ti VGA compatible controller:\nPCI ID:",(0,o.kt)("inlineCode",{parentName:"p"},"01:00.0"),"\nvendor ID: ",(0,o.kt)("inlineCode",{parentName:"p"},"10de"),"\ndevice ID: ",(0,o.kt)("inlineCode",{parentName:"p"},"1e04")),(0,o.kt)("h3",{id:"configure-grub-1"},"Configure GRUB"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"/etc/default/grub")),(0,o.kt)("p",null,"Apply all the related devices"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'GRUB_CMDLINE_LINUX_DEFAULT="intel_iommu=on vfio-pci.ids=10de:1e04,10de:10f7,10de:1ad6,10de:1ad7"\n')),(0,o.kt)("h3",{id:"update-grub-1"},"Update GRUB"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sudo update-grub")),(0,o.kt)("h3",{id:"reboot-1"},"Reboot"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sudo reboot")),(0,o.kt)("h3",{id:"verify-pci-device-is-managed-by-vfio-pci"},"Verify PCI device is managed by vfio-pci"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"lspci -nnv")),(0,o.kt)("p",null,"Find the line ",(0,o.kt)("inlineCode",{parentName:"p"},"Kernel driver in use")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"0b:00.0 VGA compatible controller [0300]: NVIDIA Corporation TU102 [GeForce RTX 2080 Ti] [10de:1e04] (rev a1) (prog-if 00 [VGA controller])\n...\nKernel driver in use: vfio-pci\n")),(0,o.kt)("h2",{id:"test-gpu-passthrough-on-kvm-instance"},"Test GPU passthrough on kvm instance"),(0,o.kt)("h3",{id:"fresh-install"},"Fresh install"),(0,o.kt)("p",null,"Run ",(0,o.kt)("inlineCode",{parentName:"p"},"virt-install")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"--host-device [device_id]")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"--features kvm_hidden=on")," parameters"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"virt-install ... \\\n--host-device 01:00.0 \\\n--features kvm_hidden=on \\\n")),(0,o.kt)("h3",{id:"modify-existing-instance"},"Modify existing instance"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"virsh edit [domain]")),(0,o.kt)("p",null,"Add PCI mapping ",(0,o.kt)("inlineCode",{parentName:"p"},"hostdev")," block"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"0000:01:00.0")," within the host will be mapped to ",(0,o.kt)("inlineCode",{parentName:"p"},"0000:04:00.0")," within guest"),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"bus")," number should less than virtio's"),(0,o.kt)("p",{parentName:"admonition"},"Increase virtio's bus number to spare small number for new added entry")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"<devices>\n  ...\n    <hostdev mode='subsystem' type='pci' managed='yes'>\n      <source>\n        <address domain='0x0000' bus='0x01' slot='0x00'function='0x0'/>\n      </source>\n      <address type='pci' domain='0x0000' bus='0x04'slot='0x00' function='0x0'/>\n    </hostdev>\n    <memballoon model='virtio'>\n      <address type='pci' domain='0x0000' bus='0x05'slot='0x00' function='0x0'/>\n    </memballoon>\n    <rng model='virtio'>\n      <backend model='random'>/dev/urandom</backend>\n      <address type='pci' domain='0x0000' bus='0x06'slot='0x00' function='0x0'/>\n    </rng>\n</devices>\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"kvm hidden")," within ",(0,o.kt)("inlineCode",{parentName:"p"},"features")," block"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"<features>\n...\n  <kvm>\n    <hidden state='on'/>\n  </kvm>\n</features>\n")),(0,o.kt)("h2",{id:"check-gpu-is-working-in-guest"},"Check GPU is working in guest"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"lspci")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"04:00.0 VGA compatible controller: NVIDIA Corporation TU102[GeForce RTX 2080 Ti] (rev a1)\n")),(0,o.kt)("p",null,"Install NVIDIA driver"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"sudo apt update\nsudo apt install nvidia-driver-460\nsudo reboot\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nvidia-smi")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Wed Mar 10 08:19:43 2021\n+---------------------------------------------------------------------------+\n| NVIDIA-SMI 460.39       Driver Version: 460.39       CUDVersion: 11.2     |\n|-------------------------------+--------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage GPU-Util  Compute M. |\n|                               |                    |               MIG M. |\n|===============================+====================+======================|\n|   0  GeForce RTX 208...  Off  | 00000000:04:00.0 Of|                  N/A |\n| 15%   44C    P0     1W / 250W |      0MiB / 11019Mi|      0%      Default |\n|                               |                    |                  N/A |\n+-------------------------------+--------------------+----------------------+\n+---------------------------------------------------------------------------+\nProcesses:                                                                |\n|  GPU   GI   CI        PID   Type   Procesname                  GPU Memory |\n|        ID ID                                                 Usage      |\n===========================================================================|\n|  No running processefound                                                 |\n+---------------------------------------------------------------------------+\n")),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mathiashueber.com/pci-passthrough-ubuntu-2004-virtual-machine/"},"https://mathiashueber.com/pci-passthrough-ubuntu-2004-virtual-machine/"))))}c.isMDXComponent=!0},98871:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const r={title:"OpSec",tags:["security"],date:new Date("2021-07-27T00:00:00.000Z")},i=void 0,l={permalink:"/blog/opsec",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/opsec.md",source:"@site/blog/opsec.md",title:"OpSec",description:"Two-Factor Authentication (2FA)",date:"2021-07-27T00:00:00.000Z",formattedDate:"July 27, 2021",tags:[{label:"security",permalink:"/blog/tags/security"}],readingTime:.595,hasTruncateMarker:!1,authors:[],frontMatter:{title:"OpSec",tags:["security"],date:"2021-07-27T00:00:00.000Z"},prevItem:{title:"How to interview security engineer",permalink:"/blog/how-to-interview-security-engineer"},nextItem:{title:"GCP resource hierarchy",permalink:"/blog/gcp-resource-hierarchy"}},s={authorsImageUrls:[]},p=[{value:"Two-Factor Authentication (2FA)",id:"two-factor-authentication-2fa",level:2},{value:"FileVault",id:"filevault",level:2},{value:"Seperate browsers for different purposes",id:"seperate-browsers-for-different-purposes",level:2},{value:"Email",id:"email",level:2},{value:"Privacy",id:"privacy",level:2},{value:"Periodically check your data not leaked",id:"periodically-check-your-data-not-leaked",level:2}],u={toc:p};function d(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"two-factor-authentication-2fa"},"Two-Factor Authentication (2FA)"),(0,o.kt)("p",null,"Enable Two-Factor Authentication on every service, and keep your device with you."),(0,o.kt)("h2",{id:"filevault"},"FileVault"),(0,o.kt)("p",null,"Enable FileVault to encrypt disk"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://support.apple.com/en-us/HT204837"},"Ref")),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Lock Your Desktop When You're Away.")),(0,o.kt)("h2",{id:"seperate-browsers-for-different-purposes"},"Seperate browsers for different purposes"),(0,o.kt)("p",null,"For example, I usually used two browsers(Chrome Stable and Chrome Canary). Chrome Stable for my personal use, I will install any Chrome plugin I want on this browser. Chrome Canary for company use, without any Chrome plugin installed."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://blog.chromium.org/2017/08/run-multiple-versions-of-chrome-side-by.html"},"run-multiple-versions-of-chrome-side-by.html")),(0,o.kt)("h2",{id:"email"},"Email"),(0,o.kt)("p",null,"Register SPF for your domain to detect forging sender addresses"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Sender_Policy_Framework"},"SPF")),(0,o.kt)("h2",{id:"privacy"},"Privacy"),(0,o.kt)("p",null,"Whenever we are using the software, some of them will collect your data. For example, search history."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.privacytools.io/"},"Privacy tool")),(0,o.kt)("h2",{id:"periodically-check-your-data-not-leaked"},"Periodically check your data not leaked"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://haveibeenpwned.com/"},"https://haveibeenpwned.com/")))}d.isMDXComponent=!0},11748:(e,t,n)=>{var a={"./locale":89234,"./locale.js":89234};function o(e){var t=r(e);return n(t)}function r(e){if(!n.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}o.keys=function(){return Object.keys(a)},o.resolve=r,e.exports=o,o.id=11748}}]);