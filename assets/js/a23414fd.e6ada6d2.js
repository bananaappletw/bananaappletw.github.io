(self.webpackChunkblog=self.webpackChunkblog||[]).push([[5591],{1504:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(67294),a=r(65231);a.Z.initialize({startOnLoad:!0});const n=e=>{let{chart:t}=e;return(0,o.useEffect)((()=>{a.Z.contentLoaded()}),[]),o.createElement("div",{className:"mermaid"},t)}},91277:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>s,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var o=r(87462),a=(r(67294),r(3905)),n=r(1504);const l={title:"GCP resource hierarchy",tags:["gcp"],date:new Date("2021-07-23T00:00:00.000Z")},i=void 0,p={permalink:"/blog/gcp-resource-hierarchy",editUrl:"https://github.com/bananaappletw/blog/edit/master/blog/gcp-resource-hierarchy.md",source:"@site/blog/gcp-resource-hierarchy.md",title:"GCP resource hierarchy",description:"Overview",date:"2021-07-23T00:00:00.000Z",formattedDate:"July 23, 2021",tags:[{label:"gcp",permalink:"/blog/tags/gcp"}],readingTime:1.66,hasTruncateMarker:!1,authors:[],frontMatter:{title:"GCP resource hierarchy",tags:["gcp"],date:"2021-07-23T00:00:00.000Z"},prevItem:{title:"OpSec",permalink:"/blog/opsec"},nextItem:{title:"KVM GPU passthrough Ubuntu 20.04",permalink:"/blog/kvm-gpu-passthrough-ubuntu-20-04"}},m={authorsImageUrls:[]},u=[{value:"Overview",id:"overview",level:2},{value:"Organization",id:"organization",level:2},{value:"Nested Google Group",id:"nested-google-group",level:2},{value:"IAM relationship between Google Group and Google project",id:"iam-relationship-between-google-group-and-google-project",level:2},{value:"Terraform",id:"terraform",level:2}],c={toc:u};function s(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"Scenario:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A company size of ",(0,a.kt)("inlineCode",{parentName:"li"},"200")," people seperated into ",(0,a.kt)("inlineCode",{parentName:"li"},"10")," teams."),(0,a.kt)("li",{parentName:"ul"},"Administer can have the company-wide policy to limit GCP account."),(0,a.kt)("li",{parentName:"ul"},"Easy way to switch user to the other team."),(0,a.kt)("li",{parentName:"ul"},"Single login page for user to login"),(0,a.kt)("li",{parentName:"ul"},"Each team wants its own access to its resources."),(0,a.kt)("li",{parentName:"ul"},"Also, different environment for specific purpose."),(0,a.kt)("li",{parentName:"ul"},"Sometimes, they need temporarily cooperation between teams."),(0,a.kt)("li",{parentName:"ul"},"For auditing, bills should be seperated by each team.")),(0,a.kt)("p",null,"Solution:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://support.google.com/groups"},"Google Group")," to grouping user by team or functionality."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://support.google.com/a/answer/167100"},"Nesting")," group to organize members within the team."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/creating-managing-folders"},"GCP folder")," to have hiearchy architecture."),(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/access-control-folders"},"IAM")," role by Google Group email"),(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/resource-manager/docs/organization-policy/overview"},"Organization Policy")," on GCP folder limit resource."),(0,a.kt)("li",{parentName:"ul"},"Using seperated GCP folder for different enviroment, producion, staging...... .")),(0,a.kt)("h2",{id:"organization"},"Organization"),(0,a.kt)(n.Z,{chart:"\n\tgraph LR\n\t\tR[Organization root] --\x3e A[Team A folder]\n\t\tR[Organization root] --\x3e B[Team B folder]\n\t\tA[Company folder] --\x3e A1[Team A production folder]\n\t\tA[Company folder] --\x3e A2[Team A staging folder]\n\t\tB[Company folder] --\x3e B1[Team B production folder]\n\t\tB[Company folder] --\x3e B2[Team B staging folder]\n\t\tR[Organization root] --\x3e P[playground folder]\n",mdxType:"Mermaid"}),(0,a.kt)("h2",{id:"nested-google-group"},"Nested Google Group"),(0,a.kt)(n.Z,{chart:"\ngraph LR\n    subgraph A [Team A Google Group]\n    A1[Team A production Google Group]\n    A2[Team A staging Google Group]\n    end\n",mdxType:"Mermaid"}),(0,a.kt)("h2",{id:"iam-relationship-between-google-group-and-google-project"},"IAM relationship between Google Group and Google project"),(0,a.kt)(n.Z,{chart:"\n\tgraph LR\n\t\tA[Team A Google Group] -- Folder Admin/Owner --\x3eAF[Team A folder]\n\t\tA1[Team A production Google Group] -- Folder Admin/Owner --\x3eA1F[Team A production folder]\n\t\tA2[Team A production Google Group] -- Folder Admin/Owner --\x3eA2F[Team A staging folder]\n\t\tP[playground Google Group] -- Folder Admin/Owner --\x3ePF[Team B playground folder]\n",mdxType:"Mermaid"}),(0,a.kt)("h2",{id:"terraform"},"Terraform"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://femrtnz.medium.com/automating-gcp-projects-with-terraform-d571f0d94742"},"Seed project")," (Not Recommanded)")),(0,a.kt)("p",null,"Create service account per GCP project as Terraform repo's credential."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/hashicorp/google/latest/docs"},"one-to-one mapping between Terraform repo and GCP project"))),(0,a.kt)(n.Z,{chart:"\n\tgraph LR;\n\t\tA[A GCP project] --\x3e AT[A Terraform repo];\n\t\tAT[A Terraform repo] --\x3e A[A GCP project];\n\t\tB[B GCP project] --\x3e BT[B Terraform repo];\n\t\tBT[B Terraform repo] --\x3e B[B GCP project];\n",mdxType:"Mermaid"}))}s.isMDXComponent=!0},11748:(e,t,r)=>{var o={"./locale":89234,"./locale.js":89234};function a(e){var t=n(e);return r(t)}function n(e){if(!r.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}a.keys=function(){return Object.keys(o)},a.resolve=n,e.exports=a,a.id=11748}}]);